# ============================================================
# üê≥ ComfyUI Router Dockerfile ‚Äî version stable CUDA + FFmpeg
# ============================================================

# ---- 1Ô∏è‚É£ Base : Ubuntu + CUDA 12.4 runtime ----
FROM nvidia/cuda:13.0.1-cudnn-runtime-ubuntu22.04


# --- 1Ô∏è‚É£ Configuration de base ---
ENV DEBIAN_FRONTEND=noninteractive
WORKDIR /app

# --- 2Ô∏è‚É£ Installation d√©pendances syst√®me ---
RUN apt-get update && apt-get install -y \
    software-properties-common \
    apt-transport-https \
    ca-certificates \
    curl \
    gnupg \
    libgl1 \
    python3 python3-pip python3-dev \
 && add-apt-repository -y ppa:ubuntuhandbook1/ffmpeg8 \
 && apt-get update \
 && apt-get install -y ffmpeg \
 && apt-get clean && rm -rf /var/lib/apt/lists/*

# ---- 4Ô∏è‚É£ V√©rification de ffmpeg ---


# ---- 5Ô∏è‚É£ Installation des d√©pendances Python ----
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# ---- 6Ô∏è‚É£ Copie du code source ----
COPY . .

# ---- 7Ô∏è‚É£ Pr√©paration des r√©pertoires ----
RUN mkdir -p /basedir/input /basedir/output

# ---- 8Ô∏è‚É£ Variables d‚Äôenvironnement ----
ENV PYTHONUNBUFFERED=1

# ---- 9Ô∏è‚É£ Commande par d√©faut ----
CMD ["python3", "-m", "comfyui_router.z_smartcut.smartcut"]
